<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CaseRage</title>
    <style>
        body { background: #1c1c1e; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #balance { font-size: 28px; font-weight: bold; margin-bottom: 20px; color: #ffd60a; }
        .case-wrapper { position: relative; width: 100%; max-width: 400px; height: 120px; background: #2c2c2e; border: 2px solid #3a3a3c; border-radius: 12px; overflow: hidden; }
        .pointer { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: #ff453a; z-index: 10; transform: translateX(-50%); }
        .tape { display: flex; position: absolute; left: 0; top: 10px; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
        .item { min-width: 90px; height: 90px; margin: 0 5px; background: #3a3a3c; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; font-size: 12px; border-bottom: 4px solid #8e8e93; }
        .item.legendary { border-color: #ffd60a; color: #ffd60a; }
        .item.rare { border-color: #5e5ce6; color: #5e5ce6; }
        button { margin-top: 30px; padding: 15px 40px; font-size: 18px; background: #30d158; border: none; border-radius: 12px; color: white; font-weight: bold; cursor: pointer; }
        button:disabled { background: #555; opacity: 0.7; }
    </style>
</head>
<body>

    <div id="balance">1000 ‚≠êÔ∏è</div>

    <div class="case-wrapper">
        <div class="pointer"></div>
        <div id="tape" class="tape"></div>
    </div>

    <button onclick="spin()" id="spinBtn">–ö–†–£–¢–ò–¢–¨ (100)</button>

    <script>
        const items = [
            {n: '10', v: 10, r: 'common', i: 'üí∞'},
            {n: '50', v: 50, r: 'common', i: 'üí∞'},
            {n: '120', v: 120, r: 'rare', i: 'üíé'},
            {n: '300', v: 300, r: 'rare', i: 'üî•'},
            {n: '1000', v: 1000, r: 'legendary', i: 'üëë'},
            {n: '0', v: 0, r: 'common', i: 'üí©'}
        ];

        let currentBalance = 1000;
        const tape = document.getElementById('tape');
        const btn = document.getElementById('spinBtn');
        const balEl = document.getElementById('balance');

        function init() {
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ø–∞–º—è—Ç–∏, –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä —Ä–∞–∑—Ä–µ—à–∞–µ—Ç
            try {
                const saved = localStorage.getItem('cr_bal');
                if (saved) currentBalance = parseInt(saved);
            } catch (e) { console.log("–ü–∞–º—è—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞"); }
            balEl.innerText = currentBalance + " ‚≠êÔ∏è";
            render();
        }

        function render() {
            tape.innerHTML = '';
            for (let i = 0; i < 80; i++) {
                const it = items[Math.floor(Math.random() * items.length)];
                const d = document.createElement('div');
                d.className = `item ${it.r}`;
                d.innerHTML = `<span>${it.i}</span><b>${it.n}</b>`;
                d.setAttribute('data-v', it.v);
                tape.appendChild(d);
            }
        }

        function spin() {
            if (currentBalance < 100) return alert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!");

            currentBalance -= 100;
            balEl.innerText = currentBalance + " ‚≠êÔ∏è";
            btn.disabled = true;

            const step = 100; // —à–∏—Ä–∏–Ω–∞ –∞–π—Ç–µ–º–∞
            const winIdx = 65; // –∏–Ω–¥–µ–∫—Å –ø–æ–±–µ–¥–Ω–æ–≥–æ
            const x = (winIdx * step) - (tape.parentElement.offsetWidth / 2) + (step / 2);

            tape.style.transition = 'none';
            tape.style.transform = 'translateX(0)';

            setTimeout(() => {
                tape.style.transition = 'transform 5s cubic-bezier(0.15, 0, 0.15, 1)';
                tape.style.transform = `translateX(-${x}px)`;
            }, 50);

            setTimeout(() => {
                const winVal = parseInt(tape.children[winIdx].getAttribute('data-v'));
                currentBalance += winVal;
                balEl.innerText = currentBalance + " ‚≠êÔ∏è";
                
                try { localStorage.setItem('cr_bal', currentBalance); } catch(e){}
                
                alert(winVal > 0 ? `–í—ã–ø–∞–ª–æ: ${winVal} ‚≠êÔ∏è` : "–ü—É—Å—Ç–æ! üí©");
                btn.disabled = false;
                render();
            }, 5500);
        }

        init();
    </script>
</body>
</html>
