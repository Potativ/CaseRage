// Когда выложишь сервер на Render, замени "http://localhost:3000" на свою ссылку
// Например: "https://caserage-backend.onrender.com"
const API_URL = "http://localhost:3000"; 
const USERNAME = "Player1"; 
let isSpinning = false;

async function loadBalance() {
    try {
        const response = await fetch(`${API_URL}/get-balance/${USERNAME}`);
        const data = await response.json();
        document.getElementById('balance_display').innerHTML = data.balance + " ⭐️";
    } catch (e) {
        document.getElementById('balance_display').innerHTML = "Ошибка связи";
    }
}

async function startSpin() {
    if (isSpinning) return;
    try {
        const btn = document.getElementById('spin_button');
        btn.disabled = true;

        const response = await fetch(`${API_URL}/spin`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: USERNAME })
        });
        const data = await response.json();

        if (!data.success) { alert(data.error); btn.disabled = false; return; }

        isSpinning = true;
        buildTape(data.winValue); 
        const tape = document.getElementById('tape');
        const moveX = (60 * 90) - 110;

        setTimeout(() => {
            tape.style.transition = 'transform 5s cubic-bezier(0.1, 0, 0.1, 1)';
            tape.style.transform = `translateX(-${moveX}px)`;
        }, 50);

        setTimeout(() => {
            document.getElementById('balance_display').innerHTML = data.newBalance + " ⭐️";
            alert(`Выпало: ${data.winValue} ⭐️`);
            isSpinning = false;
            btn.disabled = false;
        }, 5500);
    } catch (e) {
        alert("Нет связи с сервером!");
        document.getElementById('spin_button').disabled = false;
    }
}

loadBalance();
buildTape();